<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link th:href="@{/css/common-style.css}" rel="stylesheet" type="text/css">
    <link th:href="@{/Boostrap/css/bootstrap.css}" rel="stylesheet" type="text/css">
    <script th:src="@{js/jquery.js}" type="text/javascript"></script>
    <script th:src="@{js/anychart-bundle.min.js}" type="text/javascript"></script>
</head>
<body>

    <div id="graph" style="height:50vh"></div>

    <a href="/beehAIve_war/create_report" id="generateReport"> Generate Report </a>

    <script>
        $(document).ready(function () {
            let chart;
            let result;
            $.ajax({
                type: "GET",
                url: "produce_graph",
                data: {"hiveId": 1}, //TODO change id with current Hive
                success: function (resp) {

                    result = JSON.parse(resp)

                    let dataSet = anychart.data.set(result);

                    let weightData = dataSet.mapAs({x: 0, value: 1});
                    let humidityData = dataSet.mapAs({x: 0, value: 2});
                    let temperatureData = dataSet.mapAs({x: 0, value: 3});
                    let queenData = dataSet.mapAs({x: 0, value: 4});

                    chart = anychart.line();
                    chart.animation(true);
                    chart.title("Sensors Measurements");
                    chart.crosshair().enabled(true).yLabel(false).yStroke(null);

                    let firstSeries = chart.line(weightData);
                    firstSeries
                        .name("Weight")
                        .stroke("3 #f49595")
                        .tooltip()
                        .format("Weight: {%value}");

                    let secondSeries = chart.line(humidityData);
                    secondSeries
                        .name("Humidity")
                        .stroke("3 #f9eb97")
                        .tooltip()
                        .format("Humidity: {%value}");

                    let thirdSeries = chart.line(temperatureData);
                    thirdSeries
                        .name("Temperature")
                        .stroke("3 #a8d9f6")
                        .tooltip()
                        .format("Temperature: {%value}");

                    let fourthSeries = chart.line(queenData);
                    fourthSeries
                        .name("Queen Presence")
                        .stroke("3 #e2bbfd")
                        .tooltip()
                        .format(function() {
                            if (this.value === -20)
                                return "Queen: Absent"
                            else
                                return "Queen: Present"
                        });

                    chart.legend().enabled(true);

                    // Qui va inserito l'id del div in cui vogliamo far apparire il grafico
                    chart.container('graph');

                    chart.draw();
                }
            })

            $("#generateReport").click(function() {
                //TODO change HiveName
                let filename = "HiveName_Sensor_Measurements_" + result[0][0] + "_" + result[result.length -1][0]
                chart.saveAsPdf({"filename": filename});
            })
        })
    </script>

</body>
</html>